# 什么是重构
- 名词 ： 对软件内部结构的一种调整，在不改变软件可观察行为的前提下，提高可理解性，降低修改成本的一种方式。
- 动词 ： 使用一系列手法，在不改变软件可观察行为的前提下，调整结构。
# 重构干了啥
> 名词指下面这些动作的集合名称，动词指下面的操作调整结构。 
- 前提：不改变软件可观察行为的前提下；
- 过程：调整结构；
- 目的：提高可理解性，降低修改成本；
# 重构的前提
重构不改变软件可观察行为，而不是所有行为。可观察行为是指和从前一样的行为。从前的bug依然会存在（未及时修改的情况下）。从前的业务流程依然相同。而代码引用，执行的逻辑。可能会被改变。
# 重构的过程
- 小步骤：重构的关键在于运用大量微小且保持软件行为的步骤，一步步达成大规模的修改。
- 保持软件行为：在重构的过程中很少进入不可工作的状态（软件）,即使重构没有完成也可以停止重构。
- 重构的过程不需要进行调试
# 重构的目的
重构的是为了提高可理解性，所以重构后的代码可能性能提高，也可能性能下降。它关注的不是性能。而是可维护性，可读性。它和性能优化相反，性能优化的目的是增加性能牺牲可读性。
# 两顶帽子
## 两顶帽子
重构和增加功能是两个不同的状态：
重构：只在绝对必要的情况下修改测试，否则不去改变测试，改变可观察行为。
增加功能：只增加功能，测试。不管原来的代码。
## 帽子切换
在工作中，两个状态是互相切换的。如果在增加功能是，发现可以和旧的代码一起使用而提高性能、可读性。则可以先放下增加功能，先重构旧的代码。然后切换状态再增加新的功能。
## 工作流
开发新功能 → 思考，重构老功能成为新功能想要接入的样子 → 增加新功能 → 重构 使整体提高可读性。
# 重构的目的
- 保证程序设计的样子不被后来的代码修改。
- 消除重复代码。保证所有的行为和事物在代码中只被描述一次。
- 增加代码可读性，使软件更简单易懂。
- 重构可以帮助理解代码，更有效的写出健壮代码。
- 提高编程效率，旧的代码越好理解，新代码越好写。
# 如何重构
- 三次法则：一件事情第一次做只管去做，第二次做可以忍受，第三次做必须重构。
# 重构分类
##  预备性重构
- 场景：在开发新功能时发现对旧代码进行微调可以加速新功能开发。则要进行重构。
- 好处：
  - 开发新功能不需要额外复制许多代码
  - 如果这段重复代码发生错误，只需要修改这一处即可。
## 帮助理解的重构
- 场景：开发完代码或拿到一段代码
- 好处：
  - 重构的过程也是梳理代码的过程，使我们理解代码
  - 重构使代码更易读，其他人或者以后自己阅读都会方便。
  - 梳理代码，重构代码的过程可以发现一些隐藏的bug。
## 捡垃圾式重构
- 场景：发现几段代码差异很小或一些代码写的不好。
- 好处：
  - 使代码更加健壮
- 注意：因为重构是一小步一小步完成的，且不会破坏代码。所以这种场景可以慢慢抽时间重构。一点一点的重构。遵守营地原则。
# 重构时机
## 有计划的重构和见机行事的重构
重构应该是我们写代码的一部分，在开发功能的前后都应该伴随一些重构。重构不应该和开发分开。应该最小化的去重构。
## 长时间的重构
当发生大的重构例如换用组件库，应该讲组件库的使用分为新旧两个入口引入。在开发新功能的时，重构触及的旧功能中的组件。
- 不必单独拿出时间重构
- 减少重构bug
## 在复审的时候进行重构
在复审其他人的代码时重构可以：
1. 更深刻的理解代码
2. 更快的找出一些bug和更好的点子。
3. 更容易得看到采用点子的结果。
## 在公司中使用重构
1. 重构是日常工作的一部分，所以我们自己要坚持用重构的形式完成新功能
2. 和部门领导说出重构的好处
3. 在会议中使用重构的技巧
# 重构要面对的问题
## 延缓新功能开发
- 重构的初期可能会影响新功能的进度。但是长期下来，这绝对是应该有利于开发的事情。
- 重构有利于开发，更有利于bug调试。
## 代码所有权
- 旧代码中的函数可能被其他不知道的API调用，这个时候，我们可以将旧的设置为不推荐，新的设置为推荐。长久以后，即可删除旧的。
- 代码不应该由一个人去维护，而是团队中所有人都可以维护，但是进行修改后。应该和上一个人交流。
## 分支
- 重构会带啦更多的修改，所以会为合并分支带来更多的冲突。会为合并分支带来更多的成本。
## 测试
- 重构的前提是有一个可靠的测试。但是这比较难以实现 。但是我们任然可以在开发新功能时进行重构。这样可以让新功能和重构一起呗测试。
- 一份有自测的代码，比一份没有自测的代码更容易重构且更健壮。
## 遗留代码
- 遗留代码处理 第一步 增加测试
- 遗留代码处理 第二部 一点点的重构，在每次增加功能的时候重构
## 数据库
1. 新建要重构名称的字段
2. 修改add 方法 将旧的和新的字段绑定添加，修改
3. 在每次遇到读取的时候读取新字段
4. 长时间后删除旧的字段以及添加修改方法中的多余代码。
# 重构和框架
- 在设计程序的时，要最简单的实现当前功能即可。不必想象未来的事情。
- 未来的事情交给重构，每次添加功能，就应该对旧代码进行重构。保证整体的设计合理。
# 重构与软甲开发过程
重构在开发流程中是一个环节，整个开发流程应该包含：
1. 添加自测
2. 重构旧功能
3. 添加新功能
4. 自测。
# 重构与性能
1. 重构确实可能会带来性能的降低
2. 重构可以让代码复用率提高，在性能优化时，可以使优化的价值更大
3. 优化的困难不是优化代码，而是优化所有需要优化的点，而重构后的代码，提高了复用率导致每优化一个点就会彻底杜绝这个点。

