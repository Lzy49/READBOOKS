# 重构 API
## 将查询函数和修改函数分离
### 动机
1. 任何有返回值的函数，都不应该有看得到的副作用。
### 做法
1. 复制整个函数，将其作为一个查询函数来命名
2. 去掉造成副作用的代码。
3. 执行静态检查。
4. 查询所有调用原函数的地方。如果调用处用到了该函数的返回值，就讲其修改为新建的查询幻术调用。并在下面马上调用一次原函数。测试
5. 将原函数去掉返回值。
6. 测试。
## 函数参数化
### 动机
1. 两个函数逻辑非常相似，只有一些字面量值不同，可以将其合二为一，一参数形式传入不同的值，从而消除重复。
### 做法
1. 从这组函数中取出一个。
2. 将需要作为参数的值传入函数中
3. 修改该函数调用处。
4. 测试
5. 修改函数体，使其使用新传入的参数。
6. 逐一进行修改，为调用参数化的函数。
## 移除标记参数
### 动机
1. 标记参数让人难以理解到底有哪些函数可以调用，应该调用。尤其是通过布尔值区分功能的函数。
### 注意
1. 在函数体中流动的值不是标记值，只为修改函数内部的控制流的值才是标记参数。
2. 如果函数中有多个标记值，则无法通过该重构手法重构，可以考虑使用多个函数拼接实现函数完整逻辑。
### 做法
1. 针对参数的每一种可能值，新建一个明确函数。
2. 对于“用字面量值作为参数”的函数调用者，改为调用新建的明确的函数。
3. 测试
## 保持对象完整性
### 动机
1. 传递整个记录的方式能更好的应对变化。
2. 传递整个记录有利于函数和记录融合产生新的抽象内容
3. 传递整个记录可以减少参数个数
### 做法
1. 新建一个空函数，给他以期望中的参数列表。
2. 在新函数中调用旧函数，并吧新的参数映射到旧的参数列表中。
3. 逐一修改就得调用者，将参数集合传入新函数。测试
4. 将所有调用处修改过来后，使用内联函数将旧的函数内联到新函数中。
5. 给新函数修改名字
## 以查询取代参数
### 动机
1. 如果参数列表中的参数可以通过另一个函数简单获取，则这个参数没有必要传入
2. 如果参数可以使用全局的某个查询获得，则不必进行参数传入
### 做法
1. 提炼获取参数过程为一个新函数。
2. 将函数体内部引用该参数的地方修改为调用新的函数。
3. 全部替换完成后，使用改变函数声明去掉参数。
## 以参数取代查询
### 动机
1. 为了让代码解耦，可以将对象的某个结构通过参数形式传入。
2. 如果一个函数用同样的参数调用总是给出同样的结果。那这个函数具有“引用透明性”。这样的函数，我们不应该破坏其透明性。
### 做法
1. 将原函数中的查询函数提炼为变量
2. 创建新函数，将变量创建提炼到新函数中，并传入原函数
3. 修改所有调用处使用新函数
4. 函数改名
## 移除设值函数
### 动机
1. 如果某个字段不希望被直接改变，则不应该提供设值函数
2. 创建的对象值只在初始化时候改变。其余时候不改变。
### 做法
1. 将赋值操作搬移到构造函数中。
2. 移除除构造函数外的设置函数。
3. 修改调用处使用初始化将值传入。
4. 测试。
## 以工厂函数取代构造函数
### 动机
1. 构造函数只能返回实例对象，无法返回根据其他原因的其他值。JS 可以 但是违背了构造函数的初衷
### 做法
1. 创建工厂函数。返回调用构造函数。
2. 修改每一处调用构造函数为调用工厂函数
3. 测试。
## 以命令取代函数
### 动机
1. 当函数过于复杂，其中使用大量局部变量，想要重构。却应为局部变量产生过多传参行为。可以将其创建为一个类，或嵌套函数
### 做法
1. 为包装的函数创建一个空的类，根据该函数名为其命名。
2. 将函数实现内容搬移到类的函数中。（execute,call) 
3. 为参数创建单独字段，并在构造函数中添加对应参数。
4. 在使用出使用函数工厂函数返回，或直接使用类。
## 以函数取代命令
### 动机
1. 命令对象是为了处理复杂计算提供字段共享，如果逻辑简单则没有必要使用命令
### 做法
1. 声明函数，接收构造函数使用参返回构造函数
2. 修改所有调用者使用该函数调用。
3. 创建一个对象根据构造函数字段进行足一创建。
4. 使用对象调用命令函数。