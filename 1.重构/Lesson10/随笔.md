# 简化条件逻辑

## 分解条件表达式

### 动机

1. 条件逻辑会使代码增加复杂度，也会增加阅读的难度。
2. 条件逻辑分为两部分：为什么发生 和 发生什么。我们在调试代码时只需要关注单独一个条件和发生的事情。如果条件或分支代码无法明了的描述这两点，则应该将他们提取成一个函数。
3. 分解条件表达式 是 提炼函数的一个应用场景

### 做法

利用提取函数操作将条件和分支代码提取成一个函数。

## 合并条件表达式

### 动机

1. 当检查条件不同，结果相同时，我们应当将 3 个条件合并为一进行判定。

### 注意

1. 合并条件可以是 与 也可以是 或 分别用于以下两个场景：
   1. 两个并列条件返回相同结果使用 或
   2. 父子嵌套条件只返回一个结果使用 与
2. 如果我们认为条件彼此独立，则及时返回相同值，也可以使用两个判断进行。不过此时也可以使用分界条件表达式来进行分解。

### 操作

1. 确定条件表达式没有副作用
2. 使用适当的逻辑运算符，将两个条件表达式组合成一个
3. 测试
4. 重复以上过程，合并所有
5. 对条件表达式进行函数提炼。

## 以卫语句取代嵌套表条件表达式

### 动机

1. 条件表达式通常有两种风格：”两个条件都属于正常行为“ 和 ”只有一个是正常行为，另一个是异常情况。“ 其中 第二种中我们只需要关注正常行为即可。所以另一个条件可以使用卫语句来完成。

### 注意

1. 卫语句为的是让我们将主要注意力放在正常代码中，而非卫语句上。所以如果两个条件都是正常行为，则卫语句并不合适。
2. 如果有相同条件的卫语句可以使用 合并条件表达式 进行合并。

### 操作

1. 选中最外层需要替换的逻辑，将其替换为卫语句
2. 测试
3. 如果有需要，重复以上步骤
4. 如果卫语句有相同结果则合并条件表达式。

#### Tips

1. 我们可以将条件表达式进行反转，从而实现卫语句取代嵌套条件表达式。

```ts
function test() {
  if (obj.a) {
    if (obj.b && obj.c) {
      alert(true);
    }
  }
}
function test() {
  if (!obj.a || !obj.b || !obj.c) {
    alert(false);
  }
}
```

## 以多态取代条件表达式

### 动机

1. 一组类型，每个类型处理格子的一种条件逻辑。但是有好几个函数根据这组类型，进行分类处理。此时，我们应该为这一组类型的每个类型进行单独抽离。并为其实现 各逻辑的不同操作。
2. 一个类因为某一个条件，修改多个方法的行为。此时，应该根据这一条件独立创建该类的多态子类。并将该条件相关逻辑迁移。

### 注意

1. 因为他们是一组类型，所以他们本质上是有相通的。所以，使用集成 + 多态的形式来表达这种关系是有必要的。
2. 这样处理的好处在使用对象的操作代码通用性增加。分类独立增加扩展性。

### 操作

1. 当现在的类不具备多态行为，就先用工厂函数创建，令工厂函数返回恰当的对象实例。
2. 在调用方代码中使用工厂函数创建实例（通过类型）
3. 将带有条件逻辑的函数移动到超类中。（包含 类型判断）
4. 任选一个字累，在其中建立一个函数，使之覆盖超类中容纳条件表达式的那个函数。将该子类相关的条件表达式分支复制到新函数中。并对其进行适当调整。
5. 重复以上动作处理其他分支
6. 在超类中保留默认情况逻辑，并将其声明为 abstract .
7. 测试。

## 引入特例

### 动机

1. 当一个结构的某一个数据（多个数据）被调用者使用进行特殊处理。则我们应该将这几个数据进行整个为一个特例数据。并提供特例判定函数。给调用者使用。

### 好处

1. 当有修改时候可以统一修改一份判定条件。

### 操作

1. 区分特例和正常结构
   1. 给重构目标添加检查特例的属性，并返回 false
   2. 创建一个特例对象，其中值检查特例的属性，返回 true。
2. 修改调用者，确保每个调用者使用同函数进行判定
   1. 对特例值做比对的代码运用提炼函数，确保所有客户端都使用这个新函数，而不直接对特定值做比对。
   2. 将新的特例对象引入代码中，可以从函数调用中返回，也可以在变换函数中生成。
   3. 修改特例比对函数的主体，在其中直接检查特例属性。
3. 测试
4. 锦上添花（调用者代码中）
   1. 使用函数组合成类或函数组合成变换，将所有使用 特例后的逻辑搬移到新的对象中 (将特例逻辑独立成一个对象)
   2. 对特例比对函数使用 内联函数 ，将其内联到仍然需要的地方。（判定对象是否是特例对象，是的话使用独立逻辑）
## 引入断言
1. 断言是一种有价值的交流形式，他们告诉阅读者，程序在执行到找一个点时，当前状态做了何种建设。
2. 断言对调试也有帮助，当出现不应该的值时。我们可以提前发现，并进行纠正。
