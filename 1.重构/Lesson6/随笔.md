# 提炼函数
## why
1. 提炼函数为了让代码更易读。
2. 提炼函数可以让函数复用变简单。
## how
1. 什么时候提炼函数
   1. 函数的目的应该是完成一件事。而不是如果完成一件事。所以如果一段代码需要花时间才知道它到底干什么，则这段代码应该提炼为一个函数，并赋予合适的名字
   2. 准寻第一条的规则，代码块中的注释应该只是为了提示同行，而不是描述代码用途。
   3. 哪怕是执行一行代码，只要修改名字后更易读，那就值得提炼。
2. 函数命名
   1. 函数命名要准确，如果无法命名则放弃重构
   2. 函数命名不要怕长，一定要准确描述代码意图
## what
### 理论支持
1. 提炼函数步骤
   1. 创建一个新函数，根据函数目的命名。
   2. 将提炼的代码复制到新函数中
   3. 检查新函数中的变量。
      1. 在函数外声明，在函数内使用 -> 将声明迁移到函数内
      2. 在函数外声明，在函数内赋值 -> 先拆分变量 或 查询取代临时变量。来简化变量使用情况，再考虑提炼。
      3. 局部变量只读 -> 直接以参数形式传入
      4. 局部变量是数据结构（Object，Array) -> 直接以参数形式传入，直接对参数进行修改即可。
      5. 局部变量是值 （String,Number) -> 局部变量以参数形式传入，以返回值形式返回。并赋予外部局部变量使用。
   4. 独立运行新函数保证没有语法错误
   5. 将源函数中被提炼代码替换为目标函数的调用。
   6. 测试
   7. 查看其他代码是否有被天带阿妈相同或相似之处。考虑使用 取代内联代码 来复用新函数。
# 内联函数
## why
1. 代码本身就和函数名一样有意义。此时应该减少间接层
2. 已有的函数不合理，内联到一个大型函数中，再重新提炼出小函数。
## what
1. 检查函数，确定他是不是适合内联（例如多态，属于一个类）
2. 找出所有调用点
3. 将调用点的代码替换为该代码块（每次替换要测试）
   1. 在替换前要对代码块进行改造，或者使用搬移语句到调用者来减小步骤
4. 删除函数定义。
# 提炼变量
1. 提炼变量的核心意义在于让代码更容易被看懂
2. 提炼的代码如果在多处被使用，则可以提升到他们都可以使用到的作用域中完成。
3. 如果发现提炼的变量不仅仅限于一段逻辑，则可以考虑给其修改命名，使其更通用。
## 步骤
1. 确定要提炼的表达式没有副作用
2. 声明一个不可修改的变量，将要提炼的表达式复制一份。将结果值赋给该变量。
3. 用这个变量替换原来的表达式
4. 测试。
## tips
1. 如果有多处是用该表达式，应该考虑命名和作用域。

# 内联变量
## 动机
临时变量提供的意义和表达式提供的意义相同。
## 做法
1. 检查变量的右侧表达式没有副作用
2. 如果变量是可修改变量，则修改为不可修改并测试。保证变量值被赋值一次
3. 找到一处使用该变量的地方，将其替换为直接使用赋值语句的右侧表达式。
4. 测试。
5. 重复 3 - 4.
6. 测试。
# 改变函数声明
## 动机
1. 修改函数名，参数名让函数更为通用，代码更容易理解
2. 随代码整理的演变，函数中的逻辑会随时发生变化。修改函数让整个代码更为健壮。
3. 函数可能从独立个体提升到更多的场景，在函数提升场景后，相应的函数名，参数。也要与时俱进
## 步骤
### 简单法
#### 适用场景
1. 能够查看到变更范围，自问可以一步到位修改声明和所有调用者。
#### 做法
1. 重构函数体，移除与该函数表达意义无关的参数
2. 修改函数声明，使其能够准备描述新逻辑。
3. 找出所有使用旧函数的地方，使用新函数声明替换。
4. 测试。
### 迁移法
#### 适用场景
1. 无法确定调用者，或无法修改调用者。
#### 步骤
1. 使用提炼函数 将旧函数提炼成一个新函数。
2. 测试新函数
3. 将新函数内联到旧函数中
4. 如果新函数使用临时名字，则修改成一个恰当的名字
5. 测试。
### 对参数增删改
对参数进行增删改，要保证的是符合函数意义。将与函数意义不符的内容删除。保证函数纯粹。
# 封装变量
## 动机
1. 在迁移变量，修改变量名时，我们必须要将所有地方的所有调用该变量全部修改。而分装变量可以让我们像使用函数一样有转发机制。
2. 封装变量可以为变量增加监听功能。更好的维护全局变量。
## 步骤
1. 创建封装函数。提供 get 和 set 两种函数。
2. 测试。
3. 逐步修改使用该变量的代码，将其改为调用合适的封装函数。
4. 限制变量可见性（删除，注释）
5. 测试是否有报错。
6. 修改报错点为封装函数。
## 注意点
1. 封装变量，要注意引用值的坑。在封装内部 使用 Proxy 代理， 或者使用 计算属性对其封装更为合适。
2. 封装变量 只针对被1个函数以上使用的变量。函数局部变量，没有必要进行封装。（重构，检查负担较小）
# 变量改名
## 动机
1. 准确的函数名可以为代码带来可读性，但是我们往往会因为代码的修改，需求的增加。让一开始的变量名变味。
## 步骤
### 变量改名
1. 如果变量被广泛使用，考虑封装变量。
2. 将所有使用该变量的地方进行替换。
3. 测试。
### 常量改名
因为常量是不可变的。所以如果能全部替换则全部替换，不能可以使用代理，并标记旧变量为废弃状态
## 变量名的意义
变量名的意义在于方便大家阅读 ，如果一段逻辑可以明确说明意义，则变量名可以随意一些。
# 引入参数对象
## 动机
1. 有多个参数往往在一起出没，将这些参数组织成结构，方便复用
2. 当一个组织结构被某几个函数使用时，会催发新的重构内容。即将函数和组织对象结合，成为新的类。
## 方法
1. 为函数的参数创建一个组织（类，键值对）····
2. 给函数添加一个参数，该参数为新建的组织结构
3. 测试所有调用者。
4. 对包含的参数，逐一进行删除重构，并测试调用者。
5. 测试所有调用者
# 函数组合成类
## 动机
1. 经过引入参数对象以后。有有一些使用同类参数进行作业的函数。这些函数与参数可以组成同一个结构
2. 有一些函数往往在一起进行操作。他们之间有一些联系，这些联系成为了他们组合成函数的纽带。
## 方法
1. 运用封装记录对多个函数共用的数据记录加以封装。
2. 对使用该记录结构的每个函数，运用搬运函数将其移入新类。
3. 用以处理该数据记录的逻辑可以用提炼函数提炼出来，并移入新类。
# 函数组合成变换
## 动机
1. 工作中我们经常有将一个数据喂给一个函数计算出各种派生信息。这种行为，在程序中非常常见。而且可能有关联操作，或一个数据喂给多个不同的函数。
2. 数据喂函数的操作频繁的出现在各段代码中，导致执行函数导出都是，即使进行提炼也没有一个好的地方。这个时候我们就要使用函数组合成变化或函数组合成类来进行统一管理。
## 方法
1. 创建一个变换函数，输入参数时需要变换的记录，并直接返回该记录的值（深拷贝）
2. 挑选一块逻辑，将其主体移入变换函数中，把结果作为字段添加到输出记录中。修改客户端代码，令其使用新的字段。
3. 测试
4. 正对其他相关计算逻辑，重复上述步骤
## 函数组合成变换 和 函数组合成类
1. 风格不同 一个是函数，一个是类。
2. 函数组合成变换在一开始就将派生值计算出了，而函数组合成类是在使用时候进行计算的。所以如果修改了返回值的基本值，函数组合成变换的值会错乱。同样这个方案也不是应用于函数组合成变换。
# 拆分阶段
## 动机
当一段代码在同时处理两件不同的事，就要想办法把他们分成两个部分。因为到了需要修改的时候，只需要修改其中一个模块，完全不用回忆另一个模块的诸多细节。
## 标志
如果有一块代码中出现了上下几段，格子使用不同的一组数据和函数，这就是最明显的线索。将这些代码片段拆分成格子独立的模块。能更明确地表示出他们之间的差异。
## 方法
1. 将第二阶段的代码提炼成独立函数。
2. 测试
3. 引入一个中转数据结构，将其作为参数添加到提炼出的新函数的参数列表中。
4. 逐一检查提炼出的 第二阶段函数 的每个参数，如果某个参数被第一阶段用到，就讲起移入中转数据结构中，每次搬运后要进行测试。
5. 对第一阶段代码运用提炼函数，让提炼出的函数返回中转数据结构。传入第二阶段。
6. 测试
